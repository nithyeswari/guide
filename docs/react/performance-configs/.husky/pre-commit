#!/bin/sh
# Pre-commit hook for React Performance Checks
# 
# Installation:
# 1. npm install --save-dev husky lint-staged
# 2. npx husky install
# 3. npx husky add .husky/pre-commit "npx lint-staged"
# 4. Copy this file to .husky/pre-commit

. "$(dirname "$0")/_/husky.sh"

echo "üîç Running pre-commit performance checks..."

# Run lint-staged for performance-specific linting
npx lint-staged

# Check for accidental large file additions
echo "üì¶ Checking for large files..."
MAX_SIZE=500000  # 500KB

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

for file in $STAGED_FILES; do
  if [ -f "$file" ]; then
    FILE_SIZE=$(wc -c < "$file")
    if [ $FILE_SIZE -gt $MAX_SIZE ]; then
      echo "‚ùå File $file is too large (${FILE_SIZE} bytes > ${MAX_SIZE} bytes)"
      echo "Consider using Git LFS for large assets"
      exit 1
    fi
  fi
done

# Check for new dependencies in package.json
if git diff --cached --name-only | grep -q "package.json"; then
  echo "üìã New dependencies detected in package.json"
  echo "‚ö†Ô∏è  Remember to check bundle impact after commit"
fi

# Quick bundle size estimate (optional, can be slow)
# Uncomment if you want this check
# echo "üìä Estimating bundle impact..."
# npm run build --if-present 2>/dev/null && npx size-limit || true

echo "‚úÖ Pre-commit checks passed!"
